<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brookhaven Tycoon ‚Äî 2D, Auto‚ÄëSave, Premium & VIP</title>
<style>
  :root{
    --bg:#0e1422;
    --panel:#151c31;
    --panel-2:#1a2240;
    --text:#ecf1ff;
    --muted:#9aa4c6;
    --accent:#6be675;
    --accent-2:#8aa2ff;
    --gold:#ffd86b;
    --vip:#ffb3f5;
    --danger:#ff6b7c;
    --grid:#20294a;
    --tile:#1c2443;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--text);
    background:
      radial-gradient(1200px 900px at 0% 0%, #1a2144 0%, transparent 60%),
      linear-gradient(180deg, #0b1020, #0e1422);
  }
  .wrap{max-width:1200px; margin:0 auto; padding:20px 16px 64px}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px}
  .title{display:flex; align-items:center; gap:12px}
  .logo{width:42px; height:42px; border-radius:10px;
    background: conic-gradient(from 200deg, #6be675, #8aa2ff, #ffd86b, #6be675)}
  h1{font-size:20px; margin:0}
  .muted{color:var(--muted); font-size:13px}
  .save-indicator{font-size:12px; color:var(--muted)}
  .save-indicator .dot{display:inline-block; width:8px; height:8px; border-radius:50%; background:#7a86b6; margin-right:6px}
  .save-indicator.saved .dot{background:var(--accent); box-shadow:0 0 0 6px rgba(107,230,117,0)}
  .grid{
    display:grid; grid-template-columns: 1.1fr 0.9fr; gap:16px;
  }
  @media (max-width:1000px){ .grid{grid-template-columns:1fr} }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25)),
                linear-gradient(180deg, var(--panel), var(--panel-2));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:14px; padding:14px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 10px 30px rgba(0,0,0,0.25);
  }
  .stats{display:grid; grid-template-columns: repeat(5, 1fr); gap:12px}
  @media (max-width:800px){ .stats{grid-template-columns: repeat(2, 1fr)} }
  .stat{background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); border-radius:12px; padding:10px}
  .stat .label{font-size:12px; color:var(--muted)}
  .stat .value{font-size:20px; font-weight:800; margin-top:6px}
  .board-wrap{display:grid; grid-template-rows: auto auto; gap:12px}
  .board{
    background: linear-gradient(180deg, #111831, #0f1430);
    border:1px solid rgba(255,255,255,0.07);
    border-radius:14px; padding:12px;
  }
  .city{
    display:grid; gap:8px; padding:8px; background: var(--grid); border-radius:12px;
    grid-template-columns: repeat(6, 1fr);
  }
  @media (max-width:700px){ .city{grid-template-columns: repeat(4, 1fr)} }
  .tile{
    background: var(--tile);
    border:1px solid rgba(255,255,255,0.06);
    border-radius:10px; aspect-ratio:1 / 1; position:relative;
    display:flex; align-items:center; justify-content:center; color:#dfe7ff; font-size:24px;
    transition: transform 80ms ease, filter .15s ease;
    overflow:hidden;
  }
  .tile.empty::after{
    content:""; position:absolute; inset:0; background:
      radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,0.03), transparent 70%);
  }
  .tile:hover{ filter:brightness(1.06) }
  .sprite{
    display:flex; align-items:center; justify-content:center; flex-direction:column; gap:2px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.35);
  }
  .sprite .name{font-size:10px; color:#c7cff5; opacity:.9}
  .collect-panel{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
  .big{
    background: linear-gradient(180deg, #2a8f3e, #1e6f31);
    color:white; font-weight:800; border:none; border-radius:12px; padding:12px 14px; cursor:pointer;
    box-shadow: 0 10px 24px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.2);
  }
  .btn{
    background: linear-gradient(180deg, #2b315c, #22284a);
    color:var(--text); border:1px solid rgba(255,255,255,0.08);
    border-radius:10px; padding:10px 12px; font-weight:700; cursor:pointer;
    transition: transform 80ms ease, filter .15s ease;
  }
  .btn:hover{ filter:brightness(1.05) }
  .btn:disabled{ opacity:.5; cursor:not-allowed }
  .mini{font-size:12px; padding:6px 10px}
  .gold{ background: linear-gradient(180deg, #b6922f, #8c6f20); color:#fff6da }
  .vip{ background: linear-gradient(180deg, #b13fa2, #7f2e74); color:#ffe9fb }
  .danger{ background: linear-gradient(180deg, #8c2a3a, #6a1f2d); color:white }
  .panel-title{font-weight:800; letter-spacing:.3px; margin:0 0 10px 0; color:#dbe2ff}
  .shop-item{
    display:flex; justify-content:space-between; align-items:center; gap:10px;
    padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.07);
    background: rgba(255,255,255,0.02); margin-bottom:8px;
  }
  .badge{
    display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px;
    background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15);
    font-size:12px;
  }
  .badge.gold{ background: rgba(255,215,107,0.12); border-color: rgba(255,215,107,0.3); color:#ffe8a6 }
  .badge.vip{ background: rgba(255,179,245,0.12); border-color: rgba(255,179,245,0.35); color:#ffd6fa }
  footer{margin-top:14px; font-size:12px; color:var(--muted); display:flex; justify-content:space-between; flex-wrap:wrap}
  .gain-pop{
    position:fixed; pointer-events:none; color:#b0ffbf; font-weight:800; text-shadow:0 2px 8px rgba(0,0,0,.4);
    animation: pop 600ms ease-out forwards;
  }
  @keyframes pop{
    0%{ opacity:0; transform: translateY(0) scale(.9) }
    15%{ opacity:1 }
    100%{ opacity:0; transform: translateY(-24px) scale(1.05) }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="logo"></div>
        <div>
          <h1>Brookhaven Tycoon</h1>
          <div class="muted">2D city board. Auto‚Äësave. Premium/VIP passes. No idle simulation ‚Äî income only when you collect.</div>
        </div>
      </div>
      <div id="saveIndicator" class="save-indicator"><span class="dot"></span>Not saved</div>
    </header>

    <div class="card stats" aria-live="polite">
      <div class="stat">
        <div class="label">Cash</div>
        <div id="cash" class="value">$0</div>
      </div>
      <div class="stat">
        <div class="label">Per Collect</div>
        <div id="perCollect" class="value">$0</div>
      </div>
      <div class="stat">
        <div class="label">Multiplier</div>
        <div id="multiplier" class="value">x1.00</div>
      </div>
      <div class="stat">
        <div class="label">Lots Used</div>
        <div id="lotsUsed" class="value">0 / 24</div>
      </div>
      <div class="stat">
        <div class="label">Passes</div>
        <div class="value">
          <span class="badge gold">Premium: <b id="premiumState">No</b></span>
          <span class="badge vip" style="margin-left:6px">VIP: <b id="vipState">No</b></span>
        </div>
      </div>
    </div>

    <div class="grid" style="margin-top:18px">
      <div class="board-wrap">
        <div class="card board">
          <div class="panel-title">City Board</div>
          <div id="city" class="city" aria-label="City lots grid"></div>
        </div>

        <div class="card">
          <div class="collect-panel">
            <button id="collectBtn" class="big">Collect Income <span id="collectGain" style="opacity:.85; font-weight:800; margin-left:6px">+$0</span></button>
            <button id="saveBtn" class="btn mini">Save Now</button>
            <button id="resetBtn" class="btn mini danger">Full Reset</button>
            <div class="muted">Tip: Space = collect. 1‚Äë6 = quick buy.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="panel-title">Property Shop</div>
        <div id="shop"></div>

        <div class="panel-title" style="margin-top:14px">Passes</div>
        <div class="shop-item">
          <div class="left">
            <div><span class="badge gold">Premium Pass</span></div>
            <div class="muted">+100% to collections and 10% property discount. One‚Äëtime purchase.</div>
            <div class="muted">Cost: <b id="premiumCost">$250,000</b></div>
          </div>
          <div>
            <button id="premiumBtn" class="btn gold">Buy Premium</button>
          </div>
        </div>
        <div class="shop-item">
          <div class="left">
            <div><span class="badge vip">VIP Pass</span></div>
            <div class="muted">+300% to collections and extra 10% discount. Requires Premium.</div>
            <div class="muted">Cost: <b id="vipCost">$2,000,000</b></div>
          </div>
          <div>
            <button id="vipBtn" class="btn vip">Buy VIP</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div>No background simulation: income only when you press Collect.</div>
      <div class="muted" id="version">v1.0</div>
    </footer>
  </div>

<script>
(() => {
  "use strict";

  // ---- Constants
  const SAVE_KEY = "bh_tycoon_save_v1";
  const VERSION = "1.0";
  const GRID_CAP = 24;

  const ITEMS = [
    { id:"kiosk",   name:"Kiosk",     emoji:"üçß", baseCost:100,     yield:5,    scale:1.15 },
    { id:"house",   name:"House",     emoji:"üè†", baseCost:500,     yield:20,   scale:1.18 },
    { id:"shop",    name:"Shop",      emoji:"üõçÔ∏è", baseCost:2000,    yield:80,   scale:1.20 },
    { id:"office",  name:"Office",    emoji:"üè¢", baseCost:8000,    yield:300,  scale:1.22 },
    { id:"hotel",   name:"Hotel",     emoji:"üè®", baseCost:30000,   yield:1200, scale:1.25 },
    { id:"landmark",name:"Landmark",  emoji:"üóΩ", baseCost:150000,  yield:6000, scale:1.28 },
  ];

  // ---- State
  const state = {
    version: VERSION,
    cash: 0,
    owned: Object.fromEntries(ITEMS.map(i => [i.id, 0])),
    grid: Array(GRID_CAP).fill(null),  // store item ids
    premium: false,
    vip: false,
    lastSavedAt: 0,
  };

  // ---- DOM
  const el = {
    cash: document.getElementById("cash"),
    perCollect: document.getElementById("perCollect"),
    multiplier: document.getElementById("multiplier"),
    lotsUsed: document.getElementById("lotsUsed"),
    premiumState: document.getElementById("premiumState"),
    vipState: document.getElementById("vipState"),
    city: document.getElementById("city"),
    shop: document.getElementById("shop"),
    collectBtn: document.getElementById("collectBtn"),
    collectGain: document.getElementById("collectGain"),
    saveBtn: document.getElementById("saveBtn"),
    resetBtn: document.getElementById("resetBtn"),
    saveIndicator: document.getElementById("saveIndicator"),
    premiumBtn: document.getElementById("premiumBtn"),
    vipBtn: document.getElementById("vipBtn"),
    premiumCost: document.getElementById("premiumCost"),
    vipCost: document.getElementById("vipCost"),
    version: document.getElementById("version"),
  };
  el.version.textContent = "v" + VERSION;

  // ---- Utils
  function fmt(n){
    if (n < 1000) return "$" + Math.floor(n);
    const u = ["","K","M","B","T","Qa","Qi"];
    let i = 0, v = n;
    while (v >= 1000 && i < u.length-1){ v/=1000; i++; }
    return "$" + (v >= 100 ? v.toFixed(0) : v >= 10 ? v.toFixed(1) : v.toFixed(2)) + u[i];
  }
  function discount(){
    let d = 0;
    if (state.premium) d += 0.10;
    if (state.vip) d += 0.10;
    return d;
  }
  function itemCost(item){
    const owned = state.owned[item.id] || 0;
    const base = item.baseCost * Math.pow(item.scale, owned);
    const price = Math.floor(base * (1 - discount()));
    return Math.max(price, 1);
  }
  function lotsUsed(){ return state.grid.filter(x => x!==null).length; }
  function totalBaseYield(){
    return ITEMS.reduce((sum, it) => sum + (state.owned[it.id] * it.yield), 0);
  }
  function totalMultiplier(){
    // Additive stacking: base 1 + 1 (Premium) + 3 (VIP)
    return 1 + (state.premium ? 1 : 0) + (state.vip ? 3 : 0);
  }
  function perCollect(){
    return totalBaseYield() * totalMultiplier();
  }

  // ---- Save / Load
  function save(){
    const data = {
      v: state.version,
      cash: state.cash,
      owned: state.owned,
      grid: state.grid,
      premium: state.premium,
      vip: state.vip,
      lastSavedAt: Date.now()
    };
    localStorage.setItem(SAVE_KEY, JSON.stringify(data));
    state.lastSavedAt = data.lastSavedAt;
    pingSaved(true);
  }
  function load(){
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) return;
    try{
      const data = JSON.parse(raw);
      state.cash = data.cash ?? 0;
      state.owned = Object.assign(Object.fromEntries(ITEMS.map(i => [i.id, 0])), data.owned ?? {});
      state.grid = Array.isArray(data.grid) ? data.grid.slice(0, GRID_CAP).concat(Array(GRID_CAP).fill(null)).slice(0, GRID_CAP) : Array(GRID_CAP).fill(null);
      state.premium = !!data.premium;
      state.vip = !!data.vip;
      state.lastSavedAt = data.lastSavedAt ?? 0;
    }catch(e){
      console.warn("Failed to load save:", e);
    }
  }
  let saveTimeout=null;
  function pingSaved(isSaved){
    clearTimeout(saveTimeout);
    el.saveIndicator.classList.toggle("saved", !!isSaved);
    el.saveIndicator.innerHTML = `<span class="dot"></span>${isSaved ? "Saved" : "Changes not saved"}`;
    if (!isSaved){
      saveTimeout = setTimeout(() => save(), 1200);
    }
  }

  // ---- Rendering
  function renderStats(){
    el.cash.textContent = fmt(state.cash);
    el.perCollect.textContent = fmt(perCollect());
    el.multiplier.textContent = "x" + totalMultiplier().toFixed(2);
    el.lotsUsed.textContent = `${lotsUsed()} / ${GRID_CAP}`;
    el.premiumState.textContent = state.premium ? "Yes" : "No";
    el.vipState.textContent = state.vip ? "Yes" : "No";
    el.collectGain.textContent = "+" + fmt(perCollect());
  }
  function renderCity(){
    el.city.innerHTML = "";
    state.grid.forEach((id, idx) => {
      const tile = document.createElement("div");
      tile.className = "tile " + (id ? "filled" : "empty");
      tile.setAttribute("data-idx", idx);
      if (id){
        const item = ITEMS.find(it => it.id === id);
        const spr = document.createElement("div");
        spr.className = "sprite";
        spr.innerHTML = `<div style="font-size:28px">${item.emoji}</div><div class="name">${item.name}</div>`;
        tile.appendChild(spr);
      } else {
        tile.title = "Empty lot";
      }
      el.city.appendChild(tile);
    });
  }
  function renderShop(){
    el.shop.innerHTML = "";
    ITEMS.forEach((item, idx) => {
      const wrap = document.createElement("div");
      wrap.className = "shop-item";
      const cost = itemCost(item);
      const canBuy = state.cash >= cost && lotsUsed() < GRID_CAP;
      wrap.innerHTML = `
        <div class="left">
          <div style="font-weight:800">${item.emoji} ${item.name}</div>
          <div class="muted">Yield per collect: <b>$${item.yield}</b> ¬∑ Owned: <b>${state.owned[item.id]}</b></div>
          <div class="muted">Cost: <b>${fmt(cost)}</b> <span style="opacity:.8">${discount() ? `(discount applied)` : ""}</span></div>
        </div>
        <div>
          <button class="btn" data-id="${item.id}" title="Hotkey: ${idx+1}">Buy</button>
        </div>
      `;
      const btn = wrap.querySelector("button");
      btn.disabled = !canBuy;
      btn.addEventListener("click", () => buyItem(item.id));
      el.shop.appendChild(wrap);
    });

    // Passes
    const premPrice = 250000;
    const vipPrice = 2000000;
    el.premiumCost.textContent = fmt(premPrice);
    el.vipCost.textContent = fmt(vipPrice);

    el.premiumBtn.disabled = state.premium || state.cash < premPrice;
    el.vipBtn.disabled = !state.premium || state.vip || state.cash < vipPrice;
  }
  function renderAll(){
    renderStats();
    renderCity();
    renderShop();
  }

  // ---- Actions
  function firstEmptyLot(){
    const idx = state.grid.findIndex(x => x === null);
    return idx === -1 ? null : idx;
  }
  function buyItem(id){
    const item = ITEMS.find(i => i.id === id);
    if (!item) return;
    const price = itemCost(item);
    if (lotsUsed() >= GRID_CAP) return;
    if (state.cash < price) return;

    state.cash -= price;
    state.owned[id] = (state.owned[id] || 0) + 1;

    const slot = firstEmptyLot();
    if (slot !== null){
      state.grid[slot] = id;
      flashTile(slot);
    }

    pingSaved(false);
    renderAll();
  }
  function flashTile(idx){
    const tile = el.city.querySelector(`.tile[data-idx="${idx}"]`);
    if (!tile) return;
    tile.style.transform = "scale(1.04)";
    setTimeout(() => tile.style.transform = "", 120);
  }
  function collect(x, y){
    const gain = perCollect();
    if (gain <= 0) return;
    state.cash += gain;
    spawnPop(`+${fmt(gain)}`, x, y);
    pingSaved(false);
    renderStats();
    renderShop();
  }
  function spawnPop(text, x, y){
    const pop = document.createElement("div");
    pop.className = "gain-pop";
    pop.textContent = text;
    const off = 12;
    pop.style.left = (x ? x : window.innerWidth/2) - off + "px";
    pop.style.top = (y ? y : 0) + "px";
    document.body.appendChild(pop);
    setTimeout(() => pop.remove(), 650);
  }
  function buyPremium(){
    const price = 250000;
    if (state.premium || state.cash < price) return;
    state.cash -= price;
    state.premium = true;
    pingSaved(false);
    renderAll();
  }
  function buyVIP(){
    const price = 2000000;
    if (!state.premium || state.vip || state.cash < price) return;
    state.cash -= price;
    state.vip = true;
    pingSaved(false);
    renderAll();
  }
  function fullReset(){
    if (!confirm("This will erase ALL progress including Premium/VIP. Continue?")) return;
    localStorage.removeItem(SAVE_KEY);
    state.cash = 0;
    ITEMS.forEach(i => state.owned[i.id]=0);
    state.grid = Array(GRID_CAP).fill(null);
    state.premium = false;
    state.vip = false;
    pingSaved(false);
    renderAll();
  }

  // ---- Events
  function init(){
    load();
    buildCityGridSkeleton();
    renderAll();

    el.collectBtn.addEventListener("click", (e) => {
      const r = e.currentTarget.getBoundingClientRect();
      collect(r.left + r.width/2, r.top);
    });
    el.saveBtn.addEventListener("click", save);
    el.resetBtn.addEventListener("click", fullReset);
    el.premiumBtn.addEventListener("click", buyPremium);
    el.vipBtn.addEventListener("click", buyVIP);

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space"){ e.preventDefault(); el.collectBtn.click(); return; }
      // quick buys 1..6
      if (/Digit[1-6]/.test(e.code)){
        const idx = Number(e.code.slice(-1)) - 1;
        const item = ITEMS[idx];
        if (item) buyItem(item.id);
      }
    });

    // Safety auto-save
    setInterval(() => save(), 10000);
    window.addEventListener("beforeunload", () => { try{ save(); }catch(_){} });
  }

  function buildCityGridSkeleton(){
    // initial draw; tiles re-rendered by renderCity
    el.city.innerHTML = "";
    for (let i=0;i<GRID_CAP;i++){
      const t = document.createElement("div");
      t.className = "tile empty";
      t.setAttribute("data-idx", i);
      el.city.appendChild(t);
    }
  }

  init();
})();
</script>
</body>
</html>